apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: istio-eastwestgateway
  namespace: istio-system
  labels:
    topology.istio.io/network: "network2"
  annotations:
    argocd.argoproj.io/sync-wave: "4"
spec:
  gatewayClassName: istio-east-west
  listeners:
    - name: mesh
      port: 15008
      protocol: HBONE
      tls:
        mode: Terminate   # HBONE at the gateway
        options:
          gateway.istio.io/tls-terminate-mode: ISTIO_MUTUAL
  infrastructure:
    # These are applied to the controller-generated Service/Deployment.
    annotations:
      # Make the Service an AWS NLB with IP targets, INTERNAL (recommended for east-west)
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
      service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: "ip"
      service.beta.kubernetes.io/aws-load-balancer-scheme: "internal"
      # (optional) pin specific subnets or SGs if you manage them yourself:
      # service.beta.kubernetes.io/aws-load-balancer-subnets: "subnet-aaa,subnet-bbb"
      # service.beta.kubernetes.io/aws-load-balancer-security-groups: "sg-xxxxxxxx"
